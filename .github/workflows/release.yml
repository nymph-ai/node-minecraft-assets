name: Minecraft Assets release
on:
  repository_dispatch:
    types: [mcassets-tag]
jobs:
  update-mcassets:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - uses: actions/checkout@v4
        with:
          submodules: true
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 22.0.0
      - name: Configure git
        run: |
          git config user.name 'nymph-ai-bot'
          git config user.email 'nymph-ai-bot@users.noreply.github.com'
      - name: Update minecraft assets
        run: |
          cd minecraft-assets/
          git fetch --all --tags
          git checkout ${{ github.event.client_payload.tag }}
      - name: Bump version
        run: |
          git add minecraft-assets
          bash scripts/bump-nymph-version.sh "${{ github.event.client_payload.tag }}"
      - name: Push changes
        run: |
          if [ -z "${{ secrets.NYMPH_AI_RELEASE_TOKEN }}" ]; then
            echo "Missing NYMPH_AI_RELEASE_TOKEN secret for pushing release commits." >&2
            exit 1
          fi
          git remote set-url origin "https://x-access-token:${{ secrets.NYMPH_AI_RELEASE_TOKEN }}@github.com/nymph-ai/node-minecraft-assets.git"
          git push
